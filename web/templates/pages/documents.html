{{define "title"}}Documents - Hausdog{{end}}

{{define "content"}}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold">Documents</h1>
            <p class="text-base-content/70">Browse and manage your uploaded documents</p>
        </div>
        <a href="/upload" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
            Upload
        </a>
    </div>

    {{if .Data}}
    <!-- Status Filter Tabs -->
    <div class="tabs tabs-boxed bg-base-100 p-1">
        <a href="/documents" class="tab {{if eq .Data.Filter ""}}tab-active{{end}}">
            All
            {{if .Data.StatusCounts}}
            <span class="badge badge-sm ml-1">{{add (index .Data.StatusCounts "pending") (add (index .Data.StatusCounts "completed") (index .Data.StatusCounts "failed"))}}</span>
            {{end}}
        </a>
        <a href="/documents?status=pending" class="tab {{if eq .Data.Filter "pending"}}tab-active{{end}}">
            Pending
            {{if .Data.StatusCounts}}
            <span class="badge badge-sm badge-warning ml-1">{{index .Data.StatusCounts "pending"}}</span>
            {{end}}
        </a>
        <a href="/documents?status=completed" class="tab {{if eq .Data.Filter "completed"}}tab-active{{end}}">
            Processed
            {{if .Data.StatusCounts}}
            <span class="badge badge-sm badge-success ml-1">{{index .Data.StatusCounts "completed"}}</span>
            {{end}}
        </a>
        <a href="/documents?status=failed" class="tab {{if eq .Data.Filter "failed"}}tab-active{{end}}">
            Failed
            {{if .Data.StatusCounts}}
            <span class="badge badge-sm badge-error ml-1">{{index .Data.StatusCounts "failed"}}</span>
            {{end}}
        </a>
    </div>

    <!-- Documents List -->
    {{if .Data.Documents}}
    <div class="space-y-3">
        {{range .Data.Documents}}
        <a href="/documents/{{.ID}}" class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow block">
            <div class="card-body p-4">
                <div class="flex items-center gap-4">
                    <!-- File icon or thumbnail -->
                    {{if .ThumbnailURL}}
                    <div class="w-12 h-12 rounded-lg overflow-hidden flex-shrink-0 bg-base-200">
                        <img src="{{.ThumbnailURL}}" alt="{{.Filename}}" class="w-full h-full object-cover" />
                    </div>
                    {{else}}
                    <div class="bg-base-200 p-3 rounded-lg flex-shrink-0">
                        {{if eq .ContentType "application/pdf"}}
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-error" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        {{else}}
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        {{end}}
                    </div>
                    {{end}}

                    <!-- File info -->
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium truncate">{{.Filename}}</h3>
                        <div class="flex items-center gap-3 text-sm text-base-content/60 mt-1">
                            <span>{{formatBytes .SizeBytes}}</span>
                            <span>{{.CreatedAt.Format "Jan 2, 2006"}}</span>
                        </div>
                    </div>

                    <!-- Status badge -->
                    <div class="flex-shrink-0">
                        {{if eq .ProcessingStatus "pending"}}
                        <span class="badge badge-warning gap-1">
                            <span class="loading loading-spinner loading-xs"></span>
                            Processing
                        </span>
                        {{else if eq .ProcessingStatus "completed"}}
                        <span class="badge badge-success">Processed</span>
                        {{else if eq .ProcessingStatus "failed"}}
                        <span class="badge badge-error">Failed</span>
                        {{else}}
                        <span class="badge">{{.ProcessingStatus}}</span>
                        {{end}}
                    </div>

                    <!-- Chevron -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-base-content/40 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </div>
            </div>
        </a>
        {{end}}
    </div>

    <!-- Pagination -->
    {{if or (gt .Data.Page 1) .Data.HasMore}}
    <div class="flex justify-center gap-2">
        {{if gt .Data.Page 1}}
        <a href="/documents?page={{sub .Data.Page 1}}{{if .Data.Filter}}&status={{.Data.Filter}}{{end}}" class="btn btn-outline btn-sm">
            Previous
        </a>
        {{end}}
        <span class="btn btn-ghost btn-sm no-animation">Page {{.Data.Page}}</span>
        {{if .Data.HasMore}}
        <a href="/documents?page={{add .Data.Page 1}}{{if .Data.Filter}}&status={{.Data.Filter}}{{end}}" class="btn btn-outline btn-sm">
            Next
        </a>
        {{end}}
    </div>
    {{end}}

    {{else}}
    <!-- Empty State -->
    <div class="card bg-base-100 shadow-md">
        <div class="card-body items-center text-center py-12">
            <div class="bg-base-200 p-4 rounded-full mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-base-content/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
            </div>
            {{if .Data.Filter}}
            <h3 class="font-semibold">No {{.Data.Filter}} documents</h3>
            <p class="text-base-content/60 text-sm mt-1">Try a different filter or upload new documents.</p>
            {{else}}
            <h3 class="font-semibold">No documents yet</h3>
            <p class="text-base-content/60 text-sm mt-1">Upload receipts, manuals, and warranties to get started.</p>
            {{end}}
            <a href="/upload" class="btn btn-primary btn-sm mt-4">Upload Documents</a>
        </div>
    </div>
    {{end}}
    {{end}}
</div>
{{end}}
